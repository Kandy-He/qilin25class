<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.grosup.practice.user">

	<resultMap type="com.grosup.practice.beans.UserBean" id="BaseResultMap">
		<result column="id" jdbcType="INTEGER" property="id"/>
		<result column="name" jdbcType="VARCHAR" property="name"/>
		<result column="classID" jdbcType="INTEGER" property="classID"/>
		<result column="gender" jdbcType="INTEGER" property="gender"/>
		<result column="icon" jdbcType="VARCHAR" property="icon"/>
		<result column="wxID" jdbcType="VARCHAR" property="wxID"/>
		<result column="status" jdbcType="INTEGER" property="status"/>
		<result column="userType" jdbcType="INTEGER" property="userType"/>
		<result column="className" jdbcType="VARCHAR" property="className"/>
		<result column="gradeName" jdbcType="VARCHAR" property="gradeName"/>
		<result column="schoolName" jdbcType="VARCHAR" property="schoolName"/>
	</resultMap>
	<!-- 人员注册 -->
	<insert id="register" parameterType="com.grosup.practice.beans.UserBean">
		insert into t_student (name,gender,classID,icon,wxID,status,userType) values (#{name},#{gender},#{classID},#{icon},#{wxID},#{status},#{userType})
	</insert>
	
	<!-- 通过wxID即unionID获取用户信息 -->
	<select id="queryUserByUnionId" resultMap="BaseResultMap">
		select * from t_student where wxID = #{unionID}
	</select>
	<!-- 查询是否已经存在注册信息 -->
	<select id="queryIsExists" parameterType="java.lang.String">
		select count(*) from t_student
		<if test="wxID != null and wxID != ''">
			<where>
				wxID = #{wxID}
			</where>
		</if>
	</select>
	
	<update id="updateUserInfo" parameterType="com.grosup.practice.beans.UserBean">
		update t_student 
		set	name = #{name},gender=#{gender},classID=#{classID},icon=#{icon},status=1,userType=#{userType}
		where id = #{id}
	</update>
	
	<!-- 获取老师对应班级下所有学生信息 -->
	<!-- param：老师ID -->
	<select id="queryStudents" parameterType="java.lang.Integer" resultMap="BaseResultMap">
		select ts.id,ts.gender,ts.classID,ts.`name`,ts.userType,ts.icon,ts.`status`,tc.`name` as className,tg.`name` AS gradeName,tsc.`name` AS schoolName from t_student ts
		LEFT JOIN t_class tc ON ts.classID = tc.id LEFT JOIN t_grade tg ON tc.gradeID = tg.id LEFT JOIN t_school tsc ON tg.schoolId = tsc.id
		WHERE ts.classID =  #{classID} AND ts.userType = 0
	</select>
	<!-- 获取所有老师 -->
	<select id="queryTeachers" resultMap="BaseResultMap">
		select ts.id,ts.gender,ts.classID,ts.`name`,ts.userType,ts.icon,ts.`status`,tc.`name` as className,tg.`name` AS gradeName,tsc.`name` AS schoolName from t_student ts
		LEFT JOIN t_class tc ON ts.classID = tc.id LEFT JOIN t_grade tg ON tc.gradeID = tg.id LEFT JOIN t_school tsc ON tg.schoolId = tsc.id
		WHERE ts.userType = 1
	</select>
	
	<!-- 将注册的状态由0变为1 -->
	<update id="userCheck" parameterType="INTEGER">
		update t_student set t_student.status = 1 where id = #{userID}
	</update>
	
	<!-- 将注册的状态由0变为2 -->
	<update id="userCheckRefused" parameterType="INTEGER">
		update t_student set t_student.status = 2 where id = #{userID}
	</update>
	
	<!-- 通过wxID即unionID获取用户信息 -->
	<select id="queryUserBywxID" parameterType="java.lang.String" resultMap="BaseResultMap">
		select ts.id,ts.gender,ts.status,ts.classID,ts.`name`,ts.userType,ts.icon,tc.`name` as className,tg.`name` AS gradeName,tsc.`name` AS schoolName from t_student ts
		LEFT JOIN t_class tc ON ts.classID = tc.id LEFT JOIN t_grade tg ON tc.gradeID = tg.id LEFT JOIN t_school tsc ON tg.schoolId = tsc.id
		 where ts.wxID = #{wxID}
	</select>
</mapper>