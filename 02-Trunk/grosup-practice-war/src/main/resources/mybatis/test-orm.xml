<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.grosup.practice.test">

        
    <select id="queryTestPaperList" resultType="com.grosup.practice.beans.TestPaperBean">
        select * from t_test_paper where gradeID = #{gradeID}
    </select>
    
    <!-- 用户还没有作答 -->
    <select id="getQuesUserUnDone" parameterType="java.util.Map" resultType="com.grosup.practice.beans.ProblemForTestBean">
        select ttpd.quesID, ttpd.quesScore,ttpd.quesPosition,tpr.* 
        from t_test_paper_detail ttpd 
        left join t_problem tpr
        on ttpd.quesID = tpr.id
        where ttpd.quesPosition = #{quesPosition}
        and ttpd.paperKey = #{paperKey}
    </select>
    
    <select id="getQuesUserHaveDone" parameterType="java.util.Map" resultType="com.grosup.practice.beans.QuesDetailBean">
        SELECT tutr.id,
        tutr.quesID,
        tutr.expression1,
        tutr.expression2,
        tutr.expression3,
        tutr.answerDesc,
        tutr.quesScore,
        tutr.userAnswer
        FROM t_user_test_record tutr
        where userID = #{userID} 
        and paperKey = #{paperKey}
        and quesPosition = #{quesPosition}
    </select>	
    
    <!-- 插入一条答题记录 -->	
    <insert id="userRecordAdd" parameterType="com.grosup.practice.beans.QuesDetailBean">
        insert into t_user_test_record
        (userID,paperKey,quesPosition,quesID,
        expression1,expression2,expression3,answerDesc,answer,quesScore,quesToScore,userAnswer)
        values(#{userID},#{paperKey},#{quesPosition},#{quesID},#{expression1},#{expression2},#{expression3},
        #{answerDesc},#{answer},#{quesScore},#{quesToScore},#{userAnswer})
    </insert>
    
    <update id="updateUserRecord" parameterType="com.grosup.practice.beans.QuesDetailBean">
        update t_user_test_record set
        expression1 = #{expression1},
        expression2 = #{expression2},
        expression3 = #{expression3},
        userAnswer = #{userAnswer},
        quesToScore = #{quesToScore}
        where userID = #{userID} and paperKey = #{paperKey} and quesPosition = #{quesPosition}
    </update>
    
    <select id="getPaperTotalInfo" parameterType="java.util.Map" resultType="com.grosup.practice.beans.PaperInfoBean">
        select sum(quesToScore) as totalScore, count(*) as  quesCount
        from t_user_test_record where
        where userID = {userID} and paperKey = #{paperKey}
    </select>
    
    <select id="getPaperQuesCountUnRight" parameterType="java.util.Map" resultType="int">
        select count(1) from t_user_test_record 
        where userID = {userID} and paperKey = #{paperKey} and quesToCount = 0
    </select>
    
    <!-- 提交试卷之后将数据转移到历史表 -->
    <insert id="moveRecordToHistory" parameterType="java.util.Map">
        insert into t_user_test_record_history select * from t_user_test_record
        where userID = {userID} and paperKey = #{paperKey}
    </insert>
</mapper>