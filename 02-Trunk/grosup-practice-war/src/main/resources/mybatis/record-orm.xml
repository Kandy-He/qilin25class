<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.grosup.practice.record">

	<resultMap type="com.grosup.practice.beans.RecordBean" id="BaseResultMap">
		<result column="id" jdbcType="INTEGER" property="id"/>
		<result column="userID" jdbcType="INTEGER" property="userID"/>
		<result column="recordTime" jdbcType="VARCHAR" property="recordTime"/>
		<result column="typeID" jdbcType="INTEGER" property="typeID"/>
		<result column="description" jdbcType="VARCHAR" property="description"/>
		<result column="options" jdbcType="VARCHAR" property="options"/>
		<result column="result" jdbcType="VARCHAR" property="result"/>
		<result column="correct" jdbcType="VARCHAR" property="correct"/>
		<result column="status" jdbcType="INTEGER" property="status"/>
	</resultMap>
	
	<insert id="addRecord" parameterType="com.grosup.practice.beans.RecordBean">
		insert into t_record (id,userID,recordTime,typeID,description,options,result,correct,status)
		values (#{id},#{userID},#{recordTime},#{typeID},#{description},#{options},#{result},#{correct},#{status})
	</insert>
	<!-- 	查看错题是否存在 -->
	<select id="checkIsExist" parameterType="com.grosup.practice.beans.RecordBean" resultType="int">
		select count(1) from t_record where userID = #{userID} AND id = #{id}
	</select>
	<!-- 	更新错题记录 -->
	<update id="updateRecord" parameterType="com.grosup.practice.beans.RecordBean">
		update t_record set recordTime = #{recordTime},result = #{result},status = 0
	</update>
	
	<select id="getOneRecord" parameterType="int" resultMap="BaseResultMap">
		select * from t_record
		WHERE id >= (SELECT FLOOR( MAX(id) * RAND()) FROM t_record ) AND t_record.typeID = #{typeID} AND t_record.userID = #{userID}
		order by id limit 1
	</select>
	<!-- 订正 -->
	<update id="correction" parameterType="int">
		update t_record set status = 1 where userID = #{userID} AND id = #{id}
	</update>
	<!-- 	删除 -->
	<delete id="removeRecord" parameterType="int">
		delete from t_record where id = #{id} AND userID = #{userID}
	</delete>
</mapper>